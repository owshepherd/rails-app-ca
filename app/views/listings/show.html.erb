<%= render "shared/nav" %>

<div class="jumbotron" style="background-image: url(https://www.thebetterindia.com/wp-content/uploads/2017/03/wedding-buffet-food.jpg); background-size: cover;">
<div class="row">
  <div class="col-sm-6">
    <div class="card">
      <div class="card-body">
          <h4 class="card-title"><%= @provider.name %></h4>
          <p class="card-text"><%= @provider.city %> <%= @provider.state %></p>
          <p class="card-text"><%= Cuisine.find(Listing.find(@listing.id).provider.cuisine_id).cuisine_type %></p>
          <p class="card-text"><strong>Cost per head:</strong> <%= sprintf("$%2.2f", @provider.cost_per_head) %></p>
          <p class="card-text"><strong>Minimum Persons:</strong> <%= @provider.minimum_persons %></p>
          
          <% if user_signed_in? %> 
            <%= link_to "Create a Booking", new_booking_path(:listing_info => { :provider_id => @provider }), class: "btn btn-primary" %>
          <% end %>

          <%if !current_provider.nil? && (@listing.provider == current_provider) %> 
            <%= link_to edit_listing_path(@listing.id), class:"btn btn-primary" do %>
              <i class="fa fa-pencil"></i>
            <% end %>
          <% end %>
          
          <% if user_signed_in? && current_user.admin? %>             
            <%= link_to edit_listing_path(@listing.id), class:"btn btn-primary" do %>
              <i class="fa fa-pencil"></i>
            <% end %> 

            <%= link_to listings_path(@listing.id), method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-primary" do %>
              <i class="fa fa-trash"></i>
            <% end %>
          <% end %> 

        </div>
      </div>
    </div>
  </div>
</div>

<!---
<h2><%= @listing.name %></h2>

<p>Contact: <%= @provider.name %></p>
<p>email: <%= @provider.email %></p>
<p>Minimum Persons: <%= @provider.minimum_persons %></p>
<p>Cost Per head: $<%= @provider.cost_per_head %></p>
<p>Provider id: <%= @provider.id %></p>
<p>Listing id: <%= @provider.listing_id %></p>

--->


<%= link_to '<< Back', listings_path %>

<!-- <% if user_signed_in? %> 
<p><strong><%= link_to "Create a Booking", new_booking_path(:listing_info => { :provider_id => @provider }) %></strong></p>
<% end %> -->


<%if !current_provider.nil? && (@listing.provider == current_provider) %> 
<%= link_to "-Edit Listing", edit_listing_path(@listing.id) %>
<% end %>

<% if user_signed_in? && current_user.admin? %>  
<%= link_to 'Edit Listing', edit_listing_path(@listing) %> 
<%= link_to 'Destroy', listings_path(@listing.id),
method: :delete,
data: { confirm: 'Are you sure?' } %>
<% end %>

<div class="UserReviewWrapper">
<% if @listing.reviews.any? %>
  <h2>User Reviews</h2>

    <% @listing.reviews.each do |review| %>
    <div class="UserReview">
    
    <p><strong>Username:</strong>
      <%= review.username %></p>
  
    <p><strong>Comment:</strong>
      <%= review.content %></p>

    <p><strong>Rating:</strong>
      <%= review.rating %></p>
    
    <p><strong>Id:</strong>
      <%= review.id %></p>

  </div>
    
    <% if user_signed_in? && (review.user_id == current_user.id) %> 
    <p><%= link_to 'Edit Review', edit_listing_review_path(@listing, review) %></p>
    <% end %>
    
    <% if user_signed_in? && current_user.admin? %> 
    <p><%= link_to 'Destroy Review', listing_review_path(@listing, review),
               method: :delete,
               data: { confirm: 'Are you sure?' } %>
    </p>
    <% end %>

  <% end %>
<% end %>
</div>


<% if user_signed_in? %> 
<h4>Add a REVIEW:</h4>

<%= render "shared/add_review" %>

 

<% end %>
<div>
<%= link_to "-Back", :back %>
<%= link_to "- Listing Page", listings_path %>
<%= link_to "- Home Page", root_path %>
</div>


